<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="RevelDigital Google Spreadsheet Gadget" description="Basic tabular display of Google spreadsheet data" author="RevelDigital" background="transparent">
  <UserPref name="spreadsheetUrl" display_name="Published spreadsheet URL" datatype="string" />
  <UserPref name="hasTitle" display_name="Use first row as header"  datatype="bool" default_value="true" />
  <UserPref name="fontFamily" display_name="Font Family" default_value="verdana" datatype="enum" >
    <EnumValue value="times new roman" display_value="Times New Roman" />
    <EnumValue value="courier new" display_value="Courier New" />
    <EnumValue value="verdana" display_value="Verdana" />
    <EnumValue value="arial" display_value="Arial" />
    <EnumValue value="tahoma" display_value="Tahoma" />
    <EnumValue value="impact" display_value="Impact" />
  </UserPref>
  <UserPref name="fontSize" display_name="Font Size" default_value="medium" datatype="enum" >
    <EnumValue value="xx-small" display_value="XX Small" />
    <EnumValue value="x-small" display_value="X Small" />
    <EnumValue value="small" display_value="Small" />
    <EnumValue value="medium" display_value="Medium" />
    <EnumValue value="large" display_value="Large" />
    <EnumValue value="x-large" display_value="X Large" />
    <EnumValue value="xx-large" display_value="XX Large" />
  </UserPref>
</ModulePrefs>
<Content type="html">
<![CDATA[

<style type="text/css">
body *
{
  line-height: 1.2em; 
  letter-spacing: 0; 
  word-spacing: normal; 
}

body
{
  background: transparent;
}

table
{
  width: 100%;
}

.header
{
  font-size: 140%;
  border: none;
  background: transparent;
}

.table
{
  font-size: 100%;
  border: none;
  background: transparent;
}

table.google-visualization-table-table,
.google-visualization-table-tr-head,
.google-visualization-table-tr-over,
.google-visualization-table-tr,
.google-visualization-table-tr-head td,
.google-visualization-table-tr-over td,
.google-visualization-table-tr td
{
    background-color: transparent;
}

</style>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>

<div id="table">
</div>

<script type="text/javascript">

  var prefs = new gadgets.Prefs();

  function load() {
  
    //$("body").prepend("<style type=\"text/css\"> body * { font-family: '" + prefs.getString("fontFamily") + "'; } </style>");
    //$("body").prepend("<style type=\"text/css\"> body * { font-size: " + prefs.getString("fontSize") + "; } </style>");
    //$("#data").height($(window).height()).width($(window).width());
    //$("#data table").css("color", prefs.getString("ForeColor"));
    //$("#data").css("background-color", prefs.getString("BackColor"));
    
    //update();
    
    //setInterval(update, 120000);
    
    google.load('visualization', '1', {'packages': ['table']});
    google.setOnLoadCallback(initialize);
  }

  gadgets.util.registerOnLoadHandler(load);
</script>

<script type="text/javascript">
  var container;
  var table;
  var max_id = 0;
  
  var update = function () {

    var url = googleUrl( prefs.getString("spreadsheetUrl") );
    
    $.getJSON(url, function(json){
      if(json) {
        cellEntries(json);
      }
    });
  }

  function initialize() {
    container = document.getElementById("table");
    table = new google.visualization.Table(container);
    
    var query = new google.visualization.Query(googleUrl('https://docs.google.com/spreadsheet/pub?key=0ApSc3DpjNyLJdGJSVk1rYS1sT3hrSmVhYkp3aFJPaXc&output=html'));
    
    query.send(draw);
  }
  
  function draw(response) {
    if (response.isError()) {
      alert('Error in query');
    }
    var dt = response.getDataTable();
    
    google.visualization.events.addListener(table, "ready",
      function (event) {
        $(".cell").css("font-size", "30px");
      }
    );
    
    google.visualization.events.addListener(table, "sort",
      function (event) {
        $(".cell").css("font-size", "30px");
      }
    );
    
    table.draw(dt, { allowHtml:false, cssClassNames: {
      headerRow: 'header',
      headerCell: 'header',
      tableRow: 'table',
      tableCell: 'table',
      selectedTableRow: 'table',
      oddTableRow: 'table',
      hoverTableRow: 'table',
      rowNumberCell: 'table'
    } });
  }
  
  var googleUrl = function (sourceIdentifier) {

    this.sourceIdentifier = sourceIdentifier;
    if (this.sourceIdentifier.match(/http(s)*:/)) {
      this.url = this.sourceIdentifier;
      try {
        this.key = this.url.match(/key=(.*?)&/)[1];
      } catch (error) {
        this.key = this.url.match(/(cells|list|values)\/(.*?)\//)[2];
      }
    } else {
      this.key = this.sourceIdentifier;
    }    
    return "https://spreadsheets.google.com/pub?key=" + this.key + "&headers=1";
  }
</script>
]]>
</Content>
</Module>