<?xml version="1.0" encoding="UTF-8" ?>

<Module>

    <ModulePrefs title="Revel Taxi Gadget" description="Displays Taxis On A Map" author="RevelDigital" background="transparent">

        <UserPref name="devRegKey" display_name="Registration Key" default_value="*|DEVICE.REGISTRATIONKEY|*" />   
        <UserPref name="rdW" display_name="Width" required="true" default_value="280" datatype="hidden" />
        <UserPref name="rdH" display_name="Height" required="true" default_value="190" datatype="hidden" />  
     
    </ModulePrefs>
<Content type="html">

  <![CDATA[
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>swiping gadget</title>
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-light_blue.min.css" />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.88/jsrender.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsviews/0.9.88/jquery.observable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsviews/0.9.88/jquery.views.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Archivo+Black" />
    <script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/nutritionLabel-min.js"></script>

    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/swipe.js" type="text/javascript"></script>
<style>
    .nf {
        border: 1px solid #000;
        padding: 6px;
        box-sizing: border-box;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 12px;
        line-height: 14px;
    }

    .nf-line {
        border-top: 1px solid #000;
        padding-top: 1px;
        padding-bottom: 1px;
        font-size: .94em;
    }

    .nf-title,
    .nf-servingUnitQuantity,
    .nf-highlight,
    .nf-serving,
    .nf-amount-per-serving,
    .nf-calories {
        font-family: 'Archivo Black', sans-serif;
    }

    .nf-title {
        font-size: 2.15em;
        line-height: 1.15em;
        margin-top: -6px;
    }

    .nf-per-container {
        font-size: 1.15em;
        line-height: normal;
    }

    .nf-serving {
        font-size: 1.2em;
        line-height: normal;
    }

    .nf-amount-per-serving {
        font-size: .94em;
    }

    .nf-calories {
        font-size: 2em;
        line-height: 1em;
    }

    .nf-percent-dv {
        font-size: .84em;
    }

    .nf-indent2 {
        margin-left: 28px;
    }

    .nf-indent {
        padding-left: 16px;
    }

    .nf-vitamin-column {
        font-size: .94em;
        padding: 1px 0;
        border-bottom: 1px solid #000;
    }

    .nf-footnote {
        padding-top: 4px;
        margin-left: 5px;
        font-size: .85em;
        line-height: 1em;
    }

    .nf-footnote:before {
        content: "*";
        float: left;
        margin-left: -5px;
    }

    .nf-text-right {
        text-align: right;
    }

    .nf-pr {
        float: right;
    }

    .nf-bar1 {
        height: 5px;
    }

    .nf-bar2 {
        height: 10px;
    }

    .nf-bar1,
    .nf-bar2 {
        background-color: #000;
    }

    .clear:before,
    .clear:after {
        content: " ";
        display: table;
    }

    .clear:after {
        clear: both;
    }
    .nf-ingredientListDiv {
        padding-top: 8px;
    }

    .nf-ingredientListDiv.scroll {
        overflow-y: scroll !important;
    }

    #nf-calcDisclaimer.scroll {
        overflow-y: scroll !important;
    }

    .nf-tblCalorieDiet {
        margin-top: 5px;
        width: 100%;
    }

    .nf-tblCalorieDiet tr th,
    .nf-tblCalorieDiet tr td {
        font-size: .80em;
    }

    .nf-customFooter,
    .nf-homeLinkPrint {
        font-size: .80em;
    }

    .nf-arrow-up,
    .nf-arrow-down {
        width: 0;
        height: 0;
        border-style: solid;
    }

    .nf-arrows {
        float: left;
        padding: 4px 5px 0 0;
    }

    .nf-arrow-up {
        margin-bottom: 3px;
        border-width: 0 5px 6px 5px;
        border-color: transparent transparent #333333 transparent;
    }

    .nf-arrow-down {
        margin-bottom: -2px;
        border-width: 6px 5px 0 5px;
        border-color: #333333 transparent transparent transparent;
    }

    .nf-unitQuantityBox,
    .nf-modifier-field {
        width: 26px;
        text-align: center;
        line-height: normal;
        border: 1px solid #666;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 1em;
        float: left;
        padding: 0;
        margin-top: 3px;
    }

    .nf-item-name {
        margin-left: 50px;
        line-height: 1.25em;
        padding-top: 4px;
        padding-bottom: 3px;
    }

    .nutritionLabel .nf-item-name.inline {
        padding-top: .2em;
        padding-top: .25em \9;
    }

    .nutritionLabel input.nf-unitQuantityBox.arrowsAreHidden {
        margin-left: 0;
    }

    div.nf-unitQuantityUp:hover, div.nf-unitQuantityDown:hover{
        cursor: pointer;
    }

    .customFooter, .nf-customFooter{
        padding-top: 10px;
    }
    .nf-servingUnitQuantity {
        display: inline-block;
    }

    .nf-item-name.nf-fixed-serving {
        margin-left: 35px;
    }

    .nf-item-name.no-indent {
        margin-left: 0;
    }
    .nf-arrowsAreHidden + input + .nf-item-name {
        margin-left: 35px;
    }

    div, span{
        outline: 0;
    }
    /*******************************************************************************************************************
    *************************************END OF THE 2018 LABEL RELATED STYLES******************************************
    ******************************************************************************************************************/

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0 0 0 0);
        border: 0;
    }

    .nutritionLabel div::-webkit-scrollbar,
    .nf div::-webkit-scrollbar {
        -webkit-appearance: none;
        width: 7px;
    }
    .nutritionLabel div::-webkit-scrollbar-thumb,
    .nf div::-webkit-scrollbar-thumb {
        border-radius: 4px;
        background-color: #c1c1c1;
        -webkit-box-shadow: 0 0 1px rgba(255,255,255,.3);
    }

    .nutritionLabel div::-webkit-scrollbar-thumb:hover,
    .nf div::-webkit-scrollbar-thumb:hover {
        background-color: #888;
    }

    .nutritionLabel div::-webkit-scrollbar-track,
    .nf div::-webkit-scrollbar-track {
        background: #e9e9e9;
        border: 0 none #fff;
        border-radius: 4px;
    }
    .naTooltip{
        visibility: collapse;
    }
    .swipe {

        overflow: hidden;
        visibility: hidden;
        position: relative;
    }
    .swipe-wrap {
        overflow: hidden;
        position: relative;
    }
    .swipe-wrap > div {
        float:left;
        width:100%;
        position: relative;
    }
    .demo-card-square.mdl-card {
        width: 410px;
        height: 750px;
    }
    .demo-card-square > .mdl-card__title {
        color: black;
        text-align: center;
    }
    .margin{
        padding-top: 10px;
    }
    img{
        padding-top: 10px;
        width: 300px;
        height: 450px;
    }
    body{
        text-align: center;
        font-family: Verdana !important;
        background-color: white;
    }
    .center {
        margin-left: auto !important;
        margin-right: auto !important;
        text-align: center
    }

    button{

        background-color: #5987ff!important;
        color: white!important;
    }
    body, html {
        overflow-x: hidden;
        overflow-y: auto;
    }
    .mdl-layout__header-row{
        padding-left: 20px;
    }
    /* entire container, keeps perspective */
    .flip-container {
        perspective: 1000px;
    }


    .flip-container, .front, .back {
        width: 320px;
        height: 480px;
    }


    .flip-container:hover .flipper, .flip-container.hover .flipper, .flip-container.flip .flipper {
        transform: rotateY(180deg);
    }

    /* flip speed goes here */
    .flipper {
        transition: 0.6s;
        transform-style: preserve-3d;

        position: relative;
    }

    /* hide back of pane during swap */
    .front, .back {
        backface-visibility: hidden;

        position: absolute;
        top: 0;
        left: 0;
    }

    /* front pane, placed above back */
    .front {
        z-index: 2;
        /* for firefox 31 */
        transform: rotateY(0deg);
    }

    /* back, initially hidden pane */
    .back {
        transform: rotateY(180deg);
    }
</style>
</head>
<body>


<div  class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header style="background-color: #f8f8f8; color: black" class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <!-- Title -->
            <span class="mdl-layout-title">Product Info</span>

        </div>
    </header>
</div>

<div  id='mySwipe' style='max-width:500px;margin-left: 14px; padding-top: 55px; padding-left: 15px' class='swipe'>
    <div class='swipe-wrap'>

    </div>
</div>
    <button style="margin-top: 20px; width: 160px" class="cart center mdl-cell mdl-cell--1-col mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
        Add To Cart
        <i style="margin-left: 5px; margin-bottom: 2px" class="material-icons">add_shopping_cart</i>
    </button>
<div>

</div>
<script type="text/javascript">
    window.onload = function() {
        var hammertime = new Hammer(document.body);
        hammertime.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
        hammertime.on('swipeleft', function (ev) {
            mySwipe.next();
        });
        hammertime.on('swiperight', function (ev) {
            mySwipe.prev();
        });
    }
</script>
<script id="productTemplate" type="text/x-jsrender">
            <div>
            <div class="mdl-layout demo-card-square mdl-card mdl-shadow--2dp">

                <div class="mdl-card__title mdl-card--expand ">
                    <h2 class="center mdl-card__title-text mdl-card--border"><b>{{:name}}</b></h2>
                </div>
                <div class="center flip-container" id="f{{:id}}">
                    <div class="flipper">
                        <div class="front">
                            <img id="p{{:id}}" draggable="false" class="center" src="{{:image_URL}}">
                        </div>
                        <div class="back center">
                            <div class="center" id="n{{:id}}"></div>
                        </div>
                    </div>
                </div>


                <div class="mdl-card__supporting-text ">
                    <h6 style="padding-bottom: 5px; margin-bottom: 0"><b>Description Title</b></h6>
                    <h8 style="padding-top: 0; margin-top: 15px; margin-bottom: 5px">Supporting Text</h8>
                </div>
                <div class=" mdl-card__actions mdl-card--border">
                    <div class="mdl-grid">
                        <button style="margin-left: 60px" class="remove mdl-cell mdl-cell--1-col mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                            <i class="material-icons">remove</i>
                        </button>
                        <p style="margin-top: 15px" class="number mdl-cell mdl-cell--1-col">1</p>
                        <button class="add mdl-cell mdl-cell--1-col mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                            <i class="material-icons">add</i>
                        </button>
                    </div>
                </div>
                <div class="mdl-card__menu">
                    <button onclick="flipImg('f{{:id}}')" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored">
                        ?
                    </button>
                </div>
            </div>
        </div>
</script>
<script>
    var prefs = new gadgets.Prefs();
    var regKey = prefs.getString("devRegKey");
    var machine = {};
    var products = [];
    var totalProducts;
    $.getJSON("https://revelvendingapi.azurewebsites.net/api/machines/"+regKey, function (data) {
        machine = data;
        $.getJSON("https://revelvendingapi.azurewebsites.net/api/products", function (data) {
            products = data;
            for(var i = 0; i<products.length; i++){
                products[i]["num"] = 1;
            }
            products = products.filter(image => machine.contents.filter(product => product.id == image.id).length>0);
            totalProducts = machine.contents.map(x => Object.assign(x, products.find(y => y.id == x.id)));
            products = totalProducts;

            var template = $.templates("#productTemplate");

            var htmlOutput = template.render(totalProducts);

            $(".swipe-wrap").html(htmlOutput);

            var lastEl;
            var elem = document.getElementById('mySwipe');
            window.mySwipe = Swipe(elem, {
                continuous: false,
                isableScroll: false,
                callback: function(index, element) {
                    var jelm = $(element);
                    jelm.css('margin-left', '4px');
                    jelm.css('margin-bottom', '4px');
                    jelm.css('margin-top', '10px');
                    if(lastEl){
                        lastEl.css('margin-left', '0px');
                        lastEl.css('margin-bottom', '0px');
                        lastEl.css('margin-top', '0px');
                    }
                    lastEl = jelm;

                }
            });
            lastEl = $(".demo-card-square:first");
            lastEl.css('margin-left', '4px');
            lastEl.css('margin-bottom', '4px');
            lastEl.css('margin-top', '10px');
            Client.callback("ready");
            $(".add").click(function() {
                if(products[mySwipe.getPos()].num<5) {
                    products[mySwipe.getPos()].num += 1;
                    var int = mySwipe.getPos();
                    document.getElementsByClassName("number")[int].innerHTML = products[mySwipe.getPos()].num;

                }
            });

            $(".remove").click(function() {
                if(products[mySwipe.getPos()].num>1){
                    products[mySwipe.getPos()].num-=1;
                    var int = mySwipe.getPos();
                    document.getElementsByClassName("number")[int].innerHTML = products[mySwipe.getPos()].num;
                }
            });

            $(".cart").click(function() {
                if (typeof Client != 'undefined') {
                    products[mySwipe.getPos()]["itemIndex"] = mySwipe.getPos();
                    Client.callback(JSON.stringify(products[mySwipe.getPos()]));
                }
                
            });
            for(var i = 0; i<totalProducts.length; i++){
               var item = totalProducts[i];
               console.log(JSON.stringify(totalProducts));
                $('#n'+item.id).nutritionLabel({
                    'showServingUnitQuantity' : item.nutritionFacts.servingsize,
                    'showIngredients' : false,
                    'itemName' : item.nutritionFacts.servingsize,

                    'dailyValueTotalFat' : item.nutritionFacts.totalfat,
                    'dailyValueSatFat' : item.nutritionFacts.satfat,
                    'dailyValueCholesterol' : item.nutritionFacts.cholosterol,
                    'dailyValueSodium' : item.nutritionFacts.sodium,
                    'dailyValueCarb' : item.nutritionFacts.carbs,
                    'dailyValueFiber' : item.nutritionFacts.fiber,

                    'showPolyFat' : false,
                    'showMonoFat' : false,

                    'valueCalories' : item.nutritionFacts.calories,
                    'valueFatCalories' : item.nutritionFacts.caloriesfromfat,
                    'valueTotalFat' : item.nutritionFacts.totalfat,
                    'valueSatFat' : item.nutritionFacts.satfat,
                    'valueTransFat' : item.nutritionFacts.transfat,
                    'valueCholesterol' : item.nutritionFacts.cholosterol,
                    'valueSodium' : item.nutritionFacts.sodium,
                    'valueTotalCarb' : item.nutritionFacts.carbs,
                    'valueFibers' : item.nutritionFacts.fiber,
                    'valueSugars' : item.nutritionFacts.sugars,
                    'valueProteins' : item.nutritionFacts.protein,
                    'valueVitaminD' : 0,
                    'valuePotassium_2018' : item.nutritionFacts.potassiumpct,
                    'valueCalcium' : item.nutritionFacts.calciumpct,
                    'valueIron' : item.nutritionFacts.ironpct,
                    'showLegacyVersion' : false
                });
            }
        });
    });

    function flipImg(id) {
        console.log(id);
        document.querySelector("#"+id).classList.toggle("hover");
    }

    function showSlide(index) {
        mySwipe.slide(index, 300);
    }
    function resetCart(){
        for(var i = 0; i<products.length; i++){
            products[i]["num"] = 1;
            document.getElementsByClassName("number")[i].innerHTML = products[mySwipe.getPos()].num;
        }
    }
</script>
</body>
</html>
  ]]>

  </Content>

</Module>
