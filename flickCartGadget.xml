<?xml version="1.0" encoding="UTF-8" ?>

<Module>

  <ModulePrefs title="Vending Flick Cart Gadget" author="RevelDigital" background="transparent"/>

  <UserPref name="regKey" display_name="regKey" default_value="*|DEVICE.REGISTRATIONKEY|*" />

  <UserPref name="rdW" display_name="Width" required="true" default_value="280" datatype="hidden" />

  <UserPref name="rdH" display_name="Height" required="true" default_value="190" datatype="hidden" />

  <Content type="html">

  <![CDATA[
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>swiping gadget</title>
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-light_blue.min.css" />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.88/jsrender.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsviews/0.9.88/jquery.observable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsviews/0.9.88/jquery.views.min.js"></script>

    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/swipe.js" type="text/javascript"></script>
    <style>
        .swipe {

            overflow: hidden;
            visibility: hidden;
            position: relative;
        }
        .swipe-wrap {
            overflow: hidden;
            position: relative;
        }
        .swipe-wrap > div {
            float:left;
            width:100%;
            position: relative;
        }
         .demo-card-square.mdl-card {
             width: 410px;
             height: 750px;
         }
        .demo-card-square > .mdl-card__title {
            color: black;
            text-align: center;
        }
        .margin{
            padding-top: 10px;
        }
        img{
            padding-top: 10px;
            width: 300px;
            height: 450px;
        }
        body{
            text-align: center;
            font-family: Verdana !important;
            background-color: white;
        }
        .center {
            margin-left: auto !important;
            margin-right: auto !important;
            text-align: center
        }

        button{

            background-color: #5987ff!important;
            color: white!important;
        }
        body, html {
            overflow-x: hidden;
            overflow-y: auto;
        }
        .mdl-layout__header-row{
            padding-left: 20px;
        }
    </style>
</head>
<body>



<div  class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header style="background-color: #f8f8f8; color: black" class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <!-- Title -->
            <span class="mdl-layout-title">Product Info</span>

        </div>
    </header>
</div>

<div  id='mySwipe' style='max-width:500px;margin-left: 14px; padding-top: 55px; padding-left: 15px' class='swipe'>
    <div class='swipe-wrap'>

    </div>
</div>
    <button style="margin-top: 20px; width: 160px" class="cart center mdl-cell mdl-cell--1-col mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
        Add To Cart
        <i style="margin-left: 5px; margin-bottom: 2px" class="material-icons">add_shopping_cart</i>
    </button>
<div>

</div>



<script type="text/javascript">
    window.onload = function() {
        var hammertime = new Hammer(document.body);
        hammertime.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
        hammertime.on('swipeleft', function (ev) {
            mySwipe.next();
        });
        hammertime.on('swiperight', function (ev) {
            mySwipe.prev();
        });
    }
</script>


<script id="productTemplate" type="text/x-jsrender">
            <div>
            <div class="mdl-layout demo-card-square mdl-card mdl-shadow--2dp">

                <div class="mdl-card__title mdl-card--expand ">
                    <h2 class="center mdl-card__title-text mdl-card--border"><b>{{:name}}</b></h2>
                </div>
                <img draggable="false" class="center" src="{{:image_URL}}">

                <div class="mdl-card__supporting-text ">
                    <h6 style="padding-bottom: 5px; margin-bottom: 0"><b>Description Title</b></h6>
                    <h8 style="padding-top: 0; margin-top: 15px; margin-bottom: 5px">Supporting Text</h8>
                </div>
                <div class=" mdl-card__actions mdl-card--border">
                    <div class="mdl-grid">
                        <button style="margin-left: 60px" class="remove mdl-cell mdl-cell--1-col mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                            <i class="material-icons">remove</i>
                        </button>
                        <p style="margin-top: 15px" class="number mdl-cell mdl-cell--1-col">1</p>
                        <button class="add mdl-cell mdl-cell--1-col mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                            <i class="material-icons">add</i>
                        </button>
                    </div>
                </div>
                <div class="mdl-card__menu">
                    <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored">
                        ?
                    </button>
                </div>
            </div>
        </div>
</script>

<script>
    //var prefs = new gadgets.Prefs();
    var regKey = "8555485e-fe76-4b26-b102-5a03691025f1";//prefs.getString("regKey");
    var machine = {};
    var products = [];
    var totalProducts;
    $.getJSON("https://revelvendingapi.azurewebsites.net/api/machines/"+regKey, function (data) {
        machine = data;
        console.log(JSON.stringify(machine));
        $.getJSON("https://revelvendingapi.azurewebsites.net/api/products", function (data) {
            products = data;
            for(var i = 0; i<products.length; i++){
                products[i]["num"] = 1;
            }
            products = products.filter(image => machine.contents.filter(product => product.id == image.id).length>0);
            totalProducts = products.map(x => Object.assign(x, machine.contents.find(y => y.id == x.id)));

            var template = $.templates("#productTemplate");

            var htmlOutput = template.render(totalProducts);

            $(".swipe-wrap").html(htmlOutput);

            var lastEl;
            var elem = document.getElementById('mySwipe');
            window.mySwipe = Swipe(elem, {
                // startSlide: 4,
                continuous: false,
                isableScroll: false,
                callback: function(index, element) {
                    var jelm = $(element);
                    jelm.css('margin-left', '4px');
                    jelm.css('margin-bottom', '4px');
                    jelm.css('margin-top', '10px');
                    if(lastEl){
                        lastEl.css('margin-left', '0px');
                        lastEl.css('margin-bottom', '0px');
                        lastEl.css('margin-top', '0px');
                    }
                    lastEl = jelm;

                }
            });
            lastEl = $(".demo-card-square:first");
            lastEl.css('margin-left', '4px');
            lastEl.css('margin-bottom', '4px');
            lastEl.css('margin-top', '10px');
            $(".add").click(function() {
                if(products[mySwipe.getPos()].num<5) {
                    products[mySwipe.getPos()].num += 1;
                    var int = mySwipe.getPos();
                    document.getElementsByClassName("number")[int].innerHTML = products[mySwipe.getPos()].num;

                }
            });

            $(".remove").click(function() {
                if(products[mySwipe.getPos()].num>1){
                    products[mySwipe.getPos()].num-=1;
                    var int = mySwipe.getPos();
                    document.getElementsByClassName("number")[int].innerHTML = products[mySwipe.getPos()].num;
                }
            });

            $(".cart").click(function() {
                alert('Number: '+products[mySwipe.getPos()].num+' Name: '+products[mySwipe.getPos()].name);
            });
        });
    });

    function showSlide (index) {
        mySwipe.slide(index, 300);
    }

    function resetCart(){
        for(var i = 0; i<products.length; i++){
            products[i]["num"] = 1;
        }
    }



</script>




</body>
</html>
  


  ]]>

  </Content>

</Module>
