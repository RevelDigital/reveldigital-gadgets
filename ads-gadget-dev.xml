<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="RevelDigital Ads Gadget" description="Reads XML" author="RevelDigital" background="transparent">
  <UserPref name="spreadsheetUrl" display_name="Published spreadsheet URL" datatype="string" />
</ModulePrefs>
<Content type="html">
<![CDATA[
<style type="text/css">
@import url(https://fonts.googleapis.com/css?family=Montserrat:400,700);

body {
    font-family: Montserrat;
}

#parent {
    width: 100%;
    margin: 0px auto;
}

#container {
    width: 75%;
    margin: 0 auto;
	color: black;
}

#infoContainer {
	position: absolute;
	top: 10px;
	left: 10px;
	color: black;
}

#overlay {
    background-color: rgba(1, 1, 1, 0.7);
    bottom: 0;
    left: 0;
    position: fixed;
    right: 0;
    top: 0;
}
</style>
<script src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/tabletop.js" type="text/javascript"></script>

<script type="text/javascript">
	setInfo('Working');
	var prefs = new gadgets.Prefs();
	gadgets.util.registerOnLoadHandler(initialize);
 
	function initialize() {		
		setInfo('Initialising');
		var link = "http://scontent.lrcdn.net/outbound-cdn-static/js/LiveRail.AdManager-1.0.js?LR_PUBLISHER_ID=144578&LR_WATERFALL=1&LR_WRAPPER_LIMIT=5&LR_URL=%24%24REFERER_ESC%24%24&LR_SUBSEQUENT_VAST2_VPAID_CALL";
		setInfo('Initial url ' + link);
		// var res = encodeURIComponent(url);
		setInfo('Encoded url ' + link);
		makeRequest(link);
	 }
  
	
	function makeRequest(url) {
		setInfo('Making proxied request');
		$.ajax({
			url: "https://as1.reveldigital.com/proxy?url=" + url,
			type: 'GET',
			dataType: 'text',
			success: function(res) {
				setContent(res);
			},
			error: function(data) {
				setInfo('Error is ' + data);
			}
		});
	}
	
	
	 
	function setContent(data) {
		var container = $('#container');
	
		var scrpt = "<script>";
		scrpt += data;
		scrpt += "<";
		scrpt += "/script>";

		var myIframe = document.getElementById("frame");
		var script = myIframe.contentWindow.document.createElement("script");
		script.type = "text/javascript";
		script.src = scrpt;
		myIframe.contentWindow.document.body.appendChild(script);
	}
	
	function setInfo(data) {
		if (true) {
			var container = $('#infoContainer');
			container.append(data + '<br>');
		}	
		if (true) {
			console.log(data);
		}
		if (false) {
			alert(data);
		}
	}
	
</script>
<body>
<p>Simple IFrame</p><br/>
<iframe src="http://www.advertisation.com/ads?key=b1393c59699a45ed51732194ae0d225a&ch=" width="300" height="600" frameborder="0" scrolling="no"></iframe>
<div id="overlay">
    
</div>
<script type="text/javascript">
	supp_key = "b1393c59699a45ed51732194ae0d225a";
	supp_time = new Date().getTime();
	supp_channel = "";
	supp_code_format = "ads-sync.js";
	supp_click = "";
	supp_custom_params = {};
</script>
<script type='text/javascript' src='http://www.advertsby.com/js/show_ads_supp.js?pubId=80114'></script>


	<div id="parent">  
		<div id="container">
			IFRAMES
			<iframe name="ad" style="height:400px">
				
			</iframe >
			
			<iframe  src='https://as1.reveldigital.com/proxy?url=http://scontent.lrcdn.net/outbound-cdn-static/js/LiveRail.AdManager-1.0.js?LR_PUBLISHER_ID=144578&LR_WATERFALL=1&LR_WRAPPER_LIMIT=5&LR_URL=%24%24REFERER_ESC%24%24&LR_SUBSEQUENT_VAST2_VPAID_CALL'>
			</iframe >
			
			<iframe  src='http://scontent.lrcdn.net/outbound-cdn-static/js/LiveRail.AdManager-1.0.js?LR_PUBLISHER_ID=144578&LR_WATERFALL=1&LR_WRAPPER_LIMIT=5&LR_URL=%24%24REFERER_ESC%24%24&LR_SUBSEQUENT_VAST2_VPAID_CALL'>
			</iframe >
			
			<iframe id="frame"></iframe>
			
		</div>
		<p id="infoContainer"></p>
	</div>
</body>]]>
</Content>
</Module>