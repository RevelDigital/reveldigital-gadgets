<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="RevelDigital Ads Gadget" description="Reads XML" author="RevelDigital" background="transparent">
  <UserPref name="spreadsheetUrl" display_name="Published spreadsheet URL" datatype="string" />
</ModulePrefs>
<Content type="html">
<![CDATA[
<style type="text/css">
@import url(https://fonts.googleapis.com/css?family=Montserrat:400,700);

body {
    font-family: Montserrat;
}

#parent {
    width: 100%;
    margin: 0px auto;
}

#container {
    width: 75%;
    margin: 0 auto;
	color: black;
}

#infoContainer {
	position: absolute;
	top: 10px;
	left: 10px;
	color: black;
}
</style>
<script src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/tabletop.js" type="text/javascript"></script>

<script type="text/javascript">
	setInfo('Working');
	var prefs = new gadgets.Prefs();
	gadgets.util.registerOnLoadHandler(initialize);
 
	function initialize() {		
		setInfo('Initialising');
		var link = "http://scontent.lrcdn.net/outbound-cdn-static/js/LiveRail.AdManager-1.0.js?LR_PUBLISHER_ID=144578&LR_WATERFALL=1&LR_WRAPPER_LIMIT=5&LR_URL=%24%24REFERER_ESC%24%24&LR_SUBSEQUENT_VAST2_VPAID_CALL";
		setInfo('Initial url ' + link);
		// var res = encodeURIComponent(url);
		setInfo('Encoded url ' + link);
		makeRequest(link);
	 }
  
	
	function makeRequest(url) {
		setInfo('Making simple request');
		$.ajax({
			url: url,
			type: 'GET',
			dataType: 'text',
			success: function(res) {
				setContent(res);
			},
			error: function(data) {
				setInfo('Error is ' + data);
			}
		});
		
		setInfo('Making proxied request');
		$.ajax({
			url: "https://as1.reveldigital.com/proxy?url=" + url,
			type: 'GET',
			dataType: 'text',
			success: function(res) {
				setContent(res);
			},
			error: function(data) {
				setInfo('Error is ' + data);
			}
		});
		
		setInfo('Making jsonp request');
		$.ajax({
			url: url,
			dataType: "jsonp",
			success: function(res) {
				setContent(res);
			},
			error: function(data) {
				setInfo('Error is ' + JSON.stringify(data));
			}
		});
	}
	 
	function setContent(data) {
		var container = $('#container');
		var script = document.createElement( 'script' );
		script.type = 'text/javascript';
		script.src = data;
		container.append(script);
	}
	
	function setInfo(data) {
		if (true) {
			var container = $('#infoContainer');
			container.append(data + '<br>');
		}	
		if (true) {
			console.log(data);
		}
		if (false) {
			alert(data);
		}
	}
	
</script>
<body>
	<div id="parent">  
		<div id="container">
		</div>
		<p id="infoContainer"></p>
	</div>
</body>]]>
</Content>
</Module>