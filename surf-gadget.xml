<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="RevelDigital Surf Info Gadget" description="Surf Gadget" author="RevelDigital" background="transparent">
  <UserPref name="apikey" display_name="Api Key" datatype="string" />
  <UserPref name="timer" display_name="Cycling Time (sec)" datatype="string" />
  <UserPref name="spotId0" display_name="Location 1." datatype="string" />
  <UserPref name="spotId1" display_name="Location 2." datatype="string" />
  <UserPref name="gadgetWidth" display_name="Width" required="true" default_value="100" datatype="hidden" />
  <UserPref name="gadgetHeight" display_name="Height" required="true" default_value="100" datatype="hidden" />
</ModulePrefs>
<Content type="html">
<![CDATA[
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<style type="text/css">

	body {
		background: transparent;
        background-image: url("http://s15.postimg.org/ek4st1k3v/background.png");
        background-repeat: no-repeat;
	}
    
    .inline {
        display:  inline;
        width: 100%;
    }
    
    .table { 
        overflow:hidden; 
        width:  639px;
    }
    
    .left { 
        float:left; width:400px; 
    }
    
    .right { 
        float:right; width:239px;  
    }
    
    #location {
        color: #000;
        text-align: left;
        font-size: medium;
        margin-top: 60px;
        margin-left: 90px;
    }
	
    #location_name {
        color: #000;
        text-align: left;
        font-size: 45px;
        font-family: Calibri;
        margin-top: 5px;
        margin-left: 90px;
        height: 60px;
        width: 20px;
    }
    
    #overview {
        color: #000;
        text-align: left;
        font-size: 30px;
        font-family: Calibri;
        margin-top: 5px;
        margin-left: 90px;
    }
    
    #weather_icon {
        margin-right: 20px;
        height: 100px;
        width: 100px;
    }
    
    #swell_icon {
        margin-right: 20px;
        height: 60px;
        width: 60px;
    }
    
    #wind_icon {
        margin-right: 20px;
        height: 60px;
        width: 60px;
    }
       
    table {
        border: none;
        border-collapse: collapse;
		width: 100%;
    }
	
	.label {
	text-align: left;
		font-size:24px; 
		font-family:Lucida Sans Unicode;
	}
	
	.value {
		font-size:22px; 
		font-family:Lucida Sans Unicode;
	}
    
</style>
<script type="text/javascript">
		var prefs = new gadgets.Prefs();
        var timer = prefs.getString("timer")
		var index = 0;

		function init() {
            resolveFirst();
		}
		  
		gadgets.util.registerOnLoadHandler(init);
		
        function resolveFirst() {
            var uri = "http://magicseaweed.com/api/" + prefs.getString("apikey") + "/forecast/?spot_id=" + prefs.getString("spotId0") + "&fields=timestamp,swell.*,wind.*,condition.temperature,condition.weather";
            var res = encodeURIComponent(uri);
            var request = createCORSRequest("get", "https://as1.reveldigital.com/proxy?url=" + res);
            if (request){
                request.onload = function(){
                    setInfo(request.responseText);
                };
                request.send();
            }
        }

        function createCORSRequest(method, url){
            var xhr = new XMLHttpRequest();
            if ("withCredentials" in xhr){
                xhr.open(method, url, true);
            } else if (typeof XDomainRequest != "undefined"){
                xhr = new XDomainRequest();
                xhr.open(method, url);
            } else {
                xhr = null;
            }
            return xhr;
        }

        
		
        function setLocation(data) {
			var container = $('#location');
			container.val(data);
		}

        function setName(data) {
			var container = $('#location_name');
			container.val(data);
		}
		
		function setInfo(data) {
			if (true) {
				var container = $('#infoContainer');
				container.append(data + '<br>');
			}	
			if (true) {
				console.log(data);
			}
		}
</script>

<body>
    <div class="table">
        <div class="left">
            <h1 id="location">CARDIFF-BY-THE-SEA, CA</h1>
            <p id="location_name"><b>CARDIFF REEF</b></p>
            <p id="overview"><b>4-6 ft/GOOD</b></p>
        </div>
        <div class="right">  
		<table>
			<tr>
				<td colspan= "2" style="text-align: right;">
					<img id="weather_icon" src="http://cdnimages.magicseaweed.com/30x30/12.png" alt="" />
				</td>
			</tr>
			<tr><th scope="row" class="label">TIDE</th><td id="tide_value" class="value"></td></tr>
			<tr>
				<td colspan= "2" style="text-align: right;">
					<img id="swell_icon" src="http://cdnimages.magicseaweed.com/30x30/12.png" alt="" />
				</td>
			</tr>
			<tr><th scope="row" class="label">WIND</th><td id="wind_value" class="value"></td></tr>
			<tr>
				<td colspan= "2" style="text-align: right;">
					<img id="wind_icon" src="http://cdnimages.magicseaweed.com/30x30/12.png" alt="" />
				</td>
			</tr>
			<tr><th scope="row" class="label">AIR</th><td id="wind_value" class="value"></td></tr>
        </div>        
    </div>
</body>]]>
</Content>
</Module>