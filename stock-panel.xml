<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="RevelDigital Stock Quote Panel" description="Large format stock quote supporting multiple symbols. Data provided for free by IEX." author="RevelDigital" background="transparent">
        <UserPref name="symbols" display_name="Stock Symbols (eg. MSFT,AIG,JPM)" datatype="string" />
        <UserPref name="font-style" display_name="Font Style" datatype="style" default_value="font-family:Verdana;color:rgb(255, 255, 255);font-size:18px;" required="true" />
        <UserPref name="duration" display_name="Display duration for each stock (seconds)" datatype="string" default_value="10" />
        <UserPref name="rdW" display_name="Width" required="true" default_value="280" datatype="hidden" />
        <UserPref name="rdH" display_name="Height" required="true" default_value="190" datatype="hidden" />
        <UserPref name="ForeColor" datatype="hidden" />
        <UserPref name="BackColor" datatype="hidden" />
    </ModulePrefs>
    <Content type="html">
        <![CDATA[

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">

<style type="text/css">

      
        body * {
            letter-spacing: 0;
            word-spacing: normal;
        }

        body {
            background: transparent;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        h1, h2, h3, h4, h5 {
          padding: 5px;
          margin: 0;
          position: absolute;
          width: 100%;
        }

        #card{
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            background-color: #FFFFFF;
            box-sizing: border-box;
            height: 90%;
            width: 99%;
            text-align: center;
        }
        
        #container {
            position: relative;
            width: 590px;
            height: 658px;
            margin: 0;
            padding: 0;
            font-family: arial,sans-serif;
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none;
        }
        
        .slides_container {
            height: 100%;
            width: 100%;
        }

        #quote {
          position: static;
          width: 100%;
          height: 100%;
          font-family: "Roboto Slab"; color: rgb(113, 113, 113); font-size: 60px;;
        }
        
        h1 {
          font-size: 2em;
          top: 15%;
        }

        h2 {
            font-size: 2em;
            font-weight: normal;
            top:40%;
        }
        
        h3 {
          font-size: .6em; 
          bottom: 15%;
        }
        
        h5 {
          font-size: .4em;
          top: 3%;
        }

        .up{
            color: 	#32CD32;
        }

        .down{
            color: red;
        }
        
</style>

<script id="template" type="text/x-handlebars-template">
    <div id="quote">

        <h5>
            {{quote.companyName}}
        </h5>

        <h1>
           <strong> {{quote.symbol}} </strong>
        </h1>

        <h2>
            ${{quote.latestPrice}}
        </h2>
      
        <h3>
            {{#if (isDown quote.change)}}<span class="down"><i class="fas fa-sort-down"></i>{{quote.change}} ({{quote.changePercent}}%)</span>
            {{else}}<span class="up"><i class="fas fa-sort-up"></i>+{{quote.change}} ({{quote.changePercent}}%)</span>{{/if}}
        </h3>

    </div>


</script>

<div id="container">

    <div class="slides_container" id = "card" ></div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/vminpoly.js"></script>
<script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/jquery.slides.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script src="https://reveldigital.github.io/gadget-common/utils.js" type="text/javascript"></script>
<script src="https://www.google.com/jsapi" type="text/javascript"></script>

<script type="text/javascript">

  var prefs = new gadgets.Prefs();

  var symbols = prefs.getString("symbols");
  
  Handlebars.registerHelper('isDown', function (price) {
      return price < 0;
  });
  
  var currentTemplate = Handlebars.compile(document.getElementById("template").innerHTML);

  function load() {
  
    WebFont.load({
      google: {
        families: [ RevelDigital.getFamilyName(prefs.getString("font-style")) ]
      }
    });
    
    get();
    
    setInterval(function() {
      get();
    }, 1000 * 60 * 30);
  }

  function get() {

    var api = 'https://api.iextrading.com/1.0/stock/market/batch?symbols=' + symbols + '&types=quote';
    $.ajax({
      type: 'GET',
      url: api,
      dataType: 'json',
      success: function(data) {
      
        $("div.slides_container").empty();
        
        for (var key in data) {
          $("div.slides_container").append(currentTemplate(data[key]));
        }
        
        $("#container").slides({
          effect: 'fade',
          pagination: false,
          generatePagination: false,
          play: prefs.getInt('duration') * 1000,
          preload: true,
          crossfade: true
        });
      }
    });
  }
  
  gadgets.util.registerOnLoadHandler(load);
  
</script>

]]>
    </Content>
</Module>
