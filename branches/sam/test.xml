
<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="Flight Status Gadget" description="Flight status gadget" author="RevelDigital" background="transparent">
  
</ModulePrefs>
<Content type="html">
<![CDATA[

<style type="text/css">

body {
  height: 100%;
  width: 100%;
}

.SectionHead {
  background-color: #CCC;
}

.DarkRowhead {
  background-color: #ddf0ff;
}

.DarkRow {
  background-color: #ddf0ff;
}

#productTable {
  cursor: pointer;
  text-align: center;
  font-weight: bold;
}

#specTable {
  overflow-y:scroll; 
  display:block;
  height: 100%;
}

#compare {
border: 1px solid #000;
width: 100%;
height: 100%;
border-collapse: collapse;
}

#compare td {
border-left: 1px solid #000;
border-right: 1px solid #000;
width: 33%;
height: 100%;
}

#compare td:first-child {
border-left: none;
}

table td, table td * {
    vertical-align: top;
}

#compare td:last-child {
border-right: none;
}

#comparePrompt {
  font-size: 27px;
  font-weight: bold;
  text-align: center;

}

#container {
  width:100%;
}



#draggable, #draggable2 { width: 100px; height: 100px; padding: 0.5em; float: left; margin: 10px 10px 10px 0; }
.droppable { width: 150px; height: 150px; padding: 0.5em; float: left; margin: 10px; }




</style>



<body>

<div class="pageWrapper">
  
  <div class="demo">

    <div class="wrapper">
      <div id="coverflow">
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
              <img src="http://www.openwarp.com/pix/testimage_SVGA.jpg" />
      </div>
    </div>

    <div id="imageCaption">
    Sample Text
    </div>


    <div id='slider'></div>
    </div>


    <div class="demo-description">
    </div>

  

    <div id="slider-wrap">
    <div id="slider-vertical"></div>
  </div>
</div>


<button id="next">Next</button>
  <button id="viewMore">Load More</button>
  <button id="reset">Reset</button>


<div id='container'>



  <div id="draggable2" class="ui-widget-content">
  <table id="productTable">
  </table>
  </div>

  <div id="draggable" class="ui-widget-content">
  <table id="productTable">
  </table>
  </div>
  


</div>



    <table id="compare" class="droppable">
      <tr>
        <td id="compare1"></td>
        <td id="compare2"><div id="comparePrompt">Drag any television into any of the three columns to compare</div></td>
        <td id="compare3"></td>
      <tr>
    </table>









</body>


  <link type="text/css" href="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/jquery-ui-1.8.5.custom.css" rel="Stylesheet" />
  
    <script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/jquery-1.6.2.min.js"></script>

    <script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/jquery-ui-1.8.9.custom.min.js"></script>


  <script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/ui.coverflow.js"></script>

  <link type="text/css" href="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/demos.css" rel="stylesheet" />
  
  <script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/jquery.mousewheel.min.js"></script>

  <script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/ui.coverflow.js"></script>


  <script src="https://reveldigital-gadgets.googlecode.com/svn/third-party/walmart_slider/app.js" type="text/javascript"></script>
  <script src="https://reveldigital-gadgets.googlecode.com/svn/third-party/jquery.ui.touch-punch.min.js" type="text/javascript"></script>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">


 

  

<script type="text/javascript">
$(function(){ 

    
    var demo = {

      yScroll: function(wrapper, scrollable) {

        var wrapper = $(wrapper), scrollable = $(scrollable),
          loading = $('<div class="loading">Loading...</div>').appendTo(wrapper),
          internal = null,
          images  = null;
          scrollable.hide();
          images = scrollable.find('img');
          completed = 0;
          
          images.each(function(){
            if (this.complete) completed++; 
          });
          
          if (completed == images.length){
            setTimeout(function(){              
              loading.hide();
              wrapper.css({overflow: 'hidden'});            
              scrollable.slideDown('slow', function(){
                enable(); 
              });         
            }, 0);  
          }
      
        
        function enable(){
          var inactiveMargin = 99,
            wrapperWidth = wrapper.width(),
            wrapperHeight = wrapper.height(),
            scrollableHeight = scrollable.outerHeight() + 2*inactiveMargin,
            wrapperOffset = 0,
            top = 0,
            lastTarget = null;

          
          wrapper.mousemove(function(e){
            lastTarget = e.target;
            wrapperOffset = wrapper.offset();   
            top = (e.pageY -  wrapperOffset.top) * (scrollableHeight - wrapperHeight) / wrapperHeight - inactiveMargin;
            if (top < 0){
              top = 0;
            }     
            wrapper.scrollTop(top);
          }); 
        }     
      }
    }

    
    demo.yScroll('#scroll-pane', 'ul#sortable');

      
  });

items = [];
indexer = -1;
queryCounter = 1;

$('#viewMore').click(function() {
  refresh('television');
});

$(function() {
  $('#specTable').toggle();
  refresh('television');
});

$('#next').click(function() {
  fillTable(++indexer);
});

$('#reset').click(function() {
  clearCurrentCache();
});

/*
$( "#productTable" ).click(function() {
  console.log('Counter: ' + indexer);
  fillTable(indexer++);
});
*/

$(function() {
    $( "#draggable2" ).draggable({revert: "valid"});
    refresh('television');
  });



$(function() {
    $( "#draggable" ).draggable({revert: "valid"});
    $( "#compare1" ).droppable({
      drop: function( event, ui ) {
        $( this )
            .html('<img src=' + items[indexer].preloadImage.src + '>' + items[indexer].specTable );
      }
    });
  });

$(function() {

    $( "#compare2" ).droppable({
      drop: function( event, ui ) {
        $( this )
            .html('<img src=' + items[indexer].preloadImage.src + '>' + items[indexer].specTable );
      }
    });
  });

$(function() {

    $( "#compare3" ).droppable({
      drop: function( event, ui ) {
        $( this )
            .html('<img src=' + items[indexer].preloadImage.src + '>' + items[indexer].specTable );
      }
    });
  });



function clearCurrentCache() {
  items.length = 0;
  queryCounter = 1;
  indexer = -1;
  $('#compare1').html('');
  $('#compare2').html('<div id="comparePrompt">Drag any television into any of the three columns to compare</div>');
  $('#compare3').html('');
}

function refresh(query) {

var url = 'https://api.walmartlabs.com/v1/search?query=' + query + '&format=json&start=' + queryCounter + '&apiKey=d6vumtb53uz7fr7e7xb4z3tm';
queryCounter += 10;
    
    $.ajax({
      url: url,
      dataType: 'JSONP',
      type: 'GET',
      success: function (data) {

        console.log(data);
        console.log("Version: 31");

        for(var i=0; i < data.items.length; i++) {
          var current = data.items[i];
          var tempImage = new Image();
          tempImage.src = current.thumbnailImage;
          current.preloadImage = tempImage;
          items.push(current);
          

          getSpectable(current.productUrl, i);

        }

        
      }
    });

}




function getSpectable(prodUrl, index) {

  var url = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22" + prodUrl + "%22%20AND%20xpath%3D%22%2F%2Ftable%5B%40class%3D'SpecTable'%5D%22&diagnostics=true"

  $.ajax({
      url: url,
      dataType: 'JSONP',
      type: 'GET',
      success: function (data) {

        items[index].specTable = data.results;

        if(index == 0) {
          fillTable(++indexer);
        }

      }
  });

}




function fillTable(index) {

  $('#productTable').empty();

  if(indexer == items.length) {
    indexer = -1;
  }

  rowCounter = 0;
  var rows = [];
  var table = document.getElementById("productTable");
 
  var current = items[index];
  for(var j = 0; j < 6; j++) {
    rows[j] = table.insertRow(j);
  }

//need cache for rating
  //rows[0].innerHTML = current.name;
  rows[1].innerHTML = '<img src=' + current.preloadImage.src + '>';
  rows[2].innerHTML =  '$' + current.salePrice + '  ' + '<img src=' + current.customerRatingImage + '>';

          
  //var div = document.getElementById("compare1");
  //div.innerHTML = current.specTable;

      

}



</script>
]]>
</Content>
</Module>