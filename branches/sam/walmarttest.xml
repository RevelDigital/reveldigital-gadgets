<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="Walart Tv Tablet Test Gadget" description="Walart Tv Tablet Test Gadget" author="RevelDigital" background="transparent">

</ModulePrefs>
<Content type="html">
<![CDATA[






<style type="text/css">

body {
  height: 100%;
  width: 100%;
}

.SectionHead {
  background-color: #CCC;
}

.DarkRowhead {
  background-color: #ddf0ff;
}

.DarkRow {
  background-color: #ddf0ff;
}

#specTable {
  overflow-y:scroll; 
  display:block;
  height: 100%;
}

#compare {
  border: 1px solid #000;
  width: 100%;
  height: 100%;
  border-collapse: collapse;
}

#compare td {
  border-left: 1px solid #000;
  border-right: 1px solid #000;
  width: 32%;
  height: 100%;
}

#compare td:first-child {
  border-left: none;
}

table td, table td * {
  vertical-align: top;
}

#compare td:last-child {
  border-right: none;
}

#container {
 overflow: auto;
  white-space:nowrap;  
 width: 100%;
 height: 210px; 
}

#scroll {
  display:inline-block;
  width: 10000px;
  height:180px;
  overflow:auto;
  white-space:nowrap;
}

.item{  
  cursor: pointer;
  text-align: center;
  font-weight: bold; width: 100px; height: 100px;  float: left; margin: 10px 10px 10px 0; 
}

.buttons {
  width:100%;
  text-align: center;
  margin: auto;
}

.tvtype {
  -webkit-box-shadow:inset 0px 1px 0px 0px #dcecfb;
  box-shadow:inset 0px 1px 0px 0px #dcecfb;
  background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #bddbfa), color-stop(1, #80b5ea) );
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#bddbfa', endColorstr='#80b5ea');
  background-color:#bddbfa;
  -webkit-border-top-left-radius:0px;
  border-top-left-radius:0px;
  -webkit-border-top-right-radius:0px;
  border-top-right-radius:0px;
  -webkit-border-bottom-right-radius:0px;
  border-bottom-right-radius:0px;
  -webkit-border-bottom-left-radius:0px;
  border-bottom-left-radius:0px;
  text-indent:0;
  border:1px solid #84bbf3;
  display:inline-block;
  color:#ffffff;
  font-family:Arial;
  font-size:27px;
  font-weight:bold;
  font-style:normal;
  height:54px;
  line-height:54px;
  width:121px;
  text-decoration:none;
  text-align:center;
  text-shadow:1px 1px 0px #528ecc;
}

.tvtype:hover {
  background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #80b5ea), color-stop(1, #bddbfa) );
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#80b5ea', endColorstr='#bddbfa');
  background-color:#80b5ea;
}

.tvtype:active {
  position:relative;
  top:1px;
}

.promptText{
  text-align: center;
  font-size: 25px;
  font-weight: bold;
  text-shadow: 1px 2px 3px #666;
  color: #FDBA31;
}

</style>



<body>

  <div class='buttons'>
    <button id='allbutton' class='tvtype'>All</button>
    <button id='ledbutton' class='tvtype'>LED</button>
    <button id='lcdbutton' class='tvtype'>LCD</button>
    <button id='smartbutton' class='tvtype'>Smart</button>
    <button id='plasmabutton' class='tvtype'>Plasma</button>
  </div>

  <div id='container'>
    <div id="scroll">
    </div>
  </div>
  

  <table id="compare">
  <div class="promptText">Swipe to and tap any television to compare.</div>
    <tr>
      <td id="compare1"></td>
      <td id="compare2"></td>
      <td id="compare3"></td>
    <tr>
  </table>

</body>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="https://reveldigital-gadgets.googlecode.com/svn/third-party/jquery.ui.touch-punch.min.js" type="text/javascript"></script>
<script src="https://reveldigital-gadgets.googlecode.com/svn/third-party/spin.min.js"></script>
  

<script type="text/javascript">


target = document.getElementById('container');

spinner = new Spinner().spin(target);

items = [];
queryCounter = 1;
currentCompare = 1;
refresherCounter = 400;
currentSearch = 'television';



$(function() {
  console.log("Version: " + 55);
  $('#container').scroll(function () { 
    


    if($(this).scrollLeft() > refresherCounter) {

      $("#scroll").width($('#scroll').width() + 1500);
      refresherCounter += 1000;
      refresh(currentSearch);  
    }
       
  });
  refresh(currentSearch);
});


$('#ledbutton').click(function() {
  currentSearch = 'led television';
  clearAll();
  spinner = new Spinner().spin(target);
  refresh(currentSearch);
});

$('#lcdbutton').click(function() {
  currentSearch = 'lcd television';
  clearAll();
  spinner = new Spinner().spin(target);
  refresh(currentSearch);
});

$('#smartbutton').click(function() {
  currentSearch = 'smart television';
  clearAll();
  spinner = new Spinner().spin(target);
  refresh(currentSearch);
});

$('#plasmabutton').click(function() {
  currentSearch = 'plasma television';
  clearAll();
  spinner = new Spinner().spin(target);
  refresh(currentSearch);
});

$('#allbutton').click(function() {
  currentSearch = 'television';
  clearAll();
  spinner = new Spinner().spin(target);
  refresh(currentSearch);
});

function clearAll() {
  $('#container').scrollLeft(0);
  spinner.stop();
  items = [];
  queryCounter = 1;
  currentCompare = 1;
  refresherCounter = 400;
  $('#compare1').empty();
  $('#compare2').empty();
  $('#compare3').empty();
  $('#scroll').empty();
  $('#scroll').width(10000);
}

var specTable = function(table, id) {
  this.htmlTable = table;
  this.itemId = id;
}

function refresh(query) {
console.log("query: " + queryCounter);
  if(queryCounter != 21) {
    var url = 'https://api.walmartlabs.com/v1/search?query=' + query + '&format=json&start=' + queryCounter + '&apiKey=d6vumtb53uz7fr7e7xb4z3tm';
    queryCounter += 10;
    
    $.ajax({
      url: url,
      dataType: 'JSONP',
      type: 'GET',
      success: function (data) {
        console.log(data);

        for(var i=0; i < data.items.length; i++) {
          var current = data.items[i];
          var tempImage = new Image();
          var tempRating = new Image();
          tempRating.src = current.customerRatingImage;
          tempImage.src = current.thumbnailImage;
          current.preloadImage = tempImage;
          current.preLoadRating = tempRating;

          items.push(current);
          
          getSpectable(current.productUrl, items.length-1);

          console.log(items.length-1);
          

        }

      }
    });
  }

  

}


function getSpectable(prodUrl, index) {

  var url = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22" + prodUrl + "%22%20AND%20xpath%3D%22%2F%2Ftable%5B%40class%3D'SpecTable'%5D%22&diagnostics=true"

  $.ajax({
      url: url,
      dataType: 'JSONP',
      type: 'GET',
      success: function (data) {

        items[index].specTable = data.results;

        if(index == 0 || index == 10) {
          createItems(index);
          fillTable(index);
          spinner.stop();

        }

      }
  });

}

function createItems(start) {


  for(var i=start; i<items.length; i++) {
    var temp = new specTable(fillTable(i), i);
    var tempDiv = $('<div></div>').addClass('item').attr('id', i).click(function() {
      try {
        if(currentCompare == 4) {
          currentCompare = 1;
        }
        $('#compare' + currentCompare++).html('<b>' + items[this.id].name.substring(0, items[this.id].name.indexOf(" ")) + items[this.id].name.substring(items[this.id].name.indexOf('"') - 3, items[this.id].name.indexOf('"') + 1) + '</b><br><img src=' + items[this.id].preloadImage.src + '><br>' + '<b>$' + items[this.id].salePrice + '  ' + '</b><img src=' + items[this.id].preLoadRating.src + '>' + items[this.id].specTable);
      }
      catch(e) {

      }
    });
    tempDiv.append(temp.htmlTable);
    $('#scroll').append(tempDiv);
  }

  
}




function fillTable(index) {

  $('#productTable').empty();



  rowCounter = 0;

  var table = $('<table></table>');
 
  var current = items[index];

  var row0 = $('<tr></tr>').html(current.name.substring(0, current.name.indexOf(" ")) + current.name.substring(current.name.indexOf('"') - 3, current.name.indexOf('"') + 1));
  var row1 = $('<tr></tr>').html('<img src=' + current.preloadImage.src + '>');
  var row2 = $('<tr></tr>').html('$' + current.salePrice + '  ' + '<img src=' + current.preLoadRating.src + '>');
  table.append(row0);
  table.append(row1);
  table.append(row2);

  return table;
      
}


</script>
]]>
</Content>
</Module>