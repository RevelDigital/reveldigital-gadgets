<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="Flight Status Gadget" description="Flight status gadget" author="RevelDigital" background="transparent">

  <UserPref name="side-a" display_name="Side A Color" datatype="color" default_value="grey" required="true" />
  <UserPref name="side-b" display_name="Side B Color" datatype="color" default_value="grey" required="true" />

  <UserPref name="num_stories" display_name="Number of Stories To Display" datatype="string" />
  <UserPref name="time_delay" display_name="Time Delay Before Flip (seconds)" datatype="string" />

  <UserPref name="orientation" display_name="Orientation" default_value="-webkit-transform: rotateY(180deg)" datatype="enum" >
    <EnumValue value="-webkit-transform: rotateX(180deg)" display_value="Vertical" />
    <EnumValue value="-webkit-transform: rotateY(180deg)" display_value="Horizontal" />
  </UserPref>

  <UserPref name="title-style" display_name="Title Style" datatype="style" default_value="font-family:Verdana;color:rgb(0, 0, 0);font-size:23px;" required="true" />
  <UserPref name="story-style" display_name="Story Style" datatype="style" default_value="font-family:Verdana;color:rgb(0, 0, 0);font-size:20px;" required="true" />

  <UserPref name="source" display_name="News Category" default_value="http://www.cbsnews.com/latest/rss/main" datatype="enum" >
    <EnumValue value="http://www.cbsnews.com/latest/rss/main" display_value="Top Stories" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/national.rss" display_value="National" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/world.rss" display_value="World" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/politics.rss" display_value="Politics" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/health.rss" display_value="Health" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/entertainment.rss" display_value="Entertainment" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/business.rss" display_value="Business" />
    <EnumValue value="http://www.cbsnews.com/feeds/rss/mostpopular/story.rss" display_value="Most Popular" />
  </UserPref>


</ModulePrefs>
<Content type="html">
<![CDATA[


<style type="text/css">


body {
    background: transparent;
}

.block {
    left: 50px;
    top: 50px;
    -webkit-transform-style: preserve-3d;
    -webkit-transition: -webkit-transform 1.5s;
}
.rotated{
    __UP_orientation__;
}
.side{
    position: absolute;
    -webkit-backface-visibility: hidden;
    -webkit-box-shadow: 0 2px 5px #666;
}
.front{
  position: relative;
  float: left;
  margin-right: 10px;
  border-radius: 10px;
  -webkit-box-shadow: 3px 3px 7px rgba(0,0,0,0.3)
  background-color: __UP_side-a__;
}
.back{
    
    __UP_orientation__;
    
    background-color: __UP_side-b__;
}

#font_side {

  border-collapse: collapse;
}


#back_side {

  border-collapse: collapse; 
}

.title {
  __UP_title-style__;
}

.desc {
  __UP_story-style__;
}

#title_cell {
  padding-bottom:25px;
  text-align: center;
}

</style>






<div id="block" class="block" onclick="changeClass()">
  <div class="front side">
    <table id='front_table'>
    </table>
  </div>
  <div class="back side">
    <table id='back_table'>
    </table>
  </div>
</div>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript">


function changeClass(){
    if(document.getElementById("block").className == "block"){
        document.getElementById("block").className += " rotated";
    }
    else{
      refreshFlipper();
        document.getElementById("block").className = "block";
        
    }
}




var prefs = new gadgets.Prefs();
function load() {
  storyCounter = 0;
  stories = [];
  update();
  setInterval(function(){
    console.log('Version: 25');
      $('.block').click();
    }, prefs.getInt('time_delay')*1000);
}

gadgets.util.registerOnLoadHandler(load);




function update() {

  var url = "https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=" + prefs.getString('num_stories') + "&callback=?&q=" + prefs.getString('source');

  $.ajax({
        url: url,
        dataType: "JSONP",
        success: function (data) {
          
          console.log(data);


          var entry = data.responseData.feed.entries;

          for(var i=0; i < entry.length; i++) {
            stories.push(entry[i]);
          }


          refreshFlipper();
        }
  });

}


function refreshFlipper() {

  $("#front_table").empty();
  $("#back_table").empty();



  for(var i=0; i<2; i++) {

    if(storyCounter == stories.length) {
      storyCounter = 0;
    }

    var currentEntry = stories[storyCounter++];

      if(i%2 == 0) {
        var table = document.getElementById("front_table");
      }
      else {
        var table = document.getElementById("back_table");
      }

      var titleRow = table.insertRow(0);
      var titleCell = titleRow.insertCell(0);
      titleCell.id = 'title_cell';
      titleCell.innerHTML = "<span class='title'>" + currentEntry.title + "</span>";

      var descRow = table.insertRow(1);
      var descCell = descRow.insertCell(0);
      if (currentEntry.content.toLowerCase().indexOf("<div>") >= 0) {
        descCell.innerHTML = "<span class='desc'>" + currentEntry.content.substring(0, currentEntry.content.indexOf('<div>')) + "</span>";
      }
      else {
        descCell.innerHTML = "<span class='desc'>" + currentEntry.content + "</span>";
      }

  }


}



</script>

]]>
</Content>
</Module>