<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="cityfusion Rss Feed" description="Displays data from cityfusion rss feed" author="RevelDigital" background="transparent">

</ModulePrefs>
<Content type="html">
<![CDATA[



<style type="text/css">

p {
  font-weight: bold;
  font-size: 30px;
}
#rssimage {
  width: 650px;
  height: 550px;
  position: absolute;
  left:100px;
  top:150px;   
}
#textboxarea {
  position: absolute;
  left: 800px;
  top: 60px;
}
#eventname {
  text-align: center;
  font-size: 70px;
}

body { 
  margin:auto;
  background-color: transparent;
  width:100%; 
  height:100%; 
} 




</style>

<body>

<img id="rssimage" src="http://placehold.it/650x550">

<div id="textboxarea">
<p id="eventname">Event Name</p>

<p id="venue">Venue(name of event venue)</p>

<p id="address">Address</p>

<p id="cost">Cost</p>

<p id="description">Description</p>
<div id="qr"></div>


</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/jquery.zrssfeed.min.js"></script>
<script src="https://reveldigital-gadgets.googlecode.com/svn/third-party/jquery.qrcode.min.js" type="text/javascript"></script>
<script type="text/javascript">



$(document).ready(function () {
  console.log("Version: " + 1);
  lastpubdate = null;
  updateRss();
  setInterval(updateRss(), 3600000);
});


function retrieveElement(xml, element) {
  return xml.substring(xml.indexOf('<' + element + '>') + element.length + 2, xml.indexOf('</' + element + '>'));
}

function updateRss() {
  $.getJSON('https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=json_xml&num=1&callback=?&q=http://www.cityfusion.ca/events/feed/', function(json) {

    if (json && json.responseStatus == 200) {
      var xml = json.responseData.xmlString;
      var pubdate = retrieveElement(xml, 'lastBuildDate');
      console.log(pubdate);
      if(pubdate != lastpubdate) {
        lastpubdate = pubdate;
        var item = xml.substring(xml.indexOf('<item>'), xml.length)

        $('#rssimage').attr('src', 'http://' + retrieveElement(item, 'image'));
        $('#address').text(retrieveElement(item, 'address'));
        $('#cost').text(retrieveElement(item, 'cost'));
        $('#eventname').text(retrieveElement(item, 'title'));
        $('#venue').text(retrieveElement(item, 'venue'));
        $('#description').text(retrieveElement(item, 'description'));

        $('#qr').qrcode({
          width: 100,
          height: 100,
          color: '#3a3',
          text: 'http://www.google.com'
        });
      }


    }
  });
}



</script>

</body>

]]>
</Content>
</Module>