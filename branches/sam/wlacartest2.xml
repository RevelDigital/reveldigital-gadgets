<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="Playlist Carousel Gadget" description="Displays a playlist in a photo carousel." author="RevelDigital" background="transparent">
  <UserPref name="time_delay" display_name="Enter delay in moving the images (seconds)" datatype="string" default_value="5" required="true" />
  <UserPref name="api_key" display_name="API Key" datatype="string" required="true" />
  <UserPref name="playlist_name" display_name="Playlist name to display images from" datatype="string" required="true" />
</ModulePrefs>
<Content type="html">
<![CDATA[

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://reveldigital-gadgets.googlecode.com/svn/third-party/jquery.waterwheelCarousel.min.js"></script>

    <script type="text/javascript">
      function getMedia() {
        var prefs = new gadgets.Prefs();
          var image = $.getJSON("http://api.reveldigital.com/playlists.json?api_key=" + prefs.getString('api_key'), function (data) {
            
            for(var i=0; i < data.length; i++) {
              var currentPlaylist = data[i];
              if(currentPlaylist.name.toLowerCase() == prefs.getString('playlist_name').toLowerCase()) {
                for(var j=0; j<currentPlaylist.sources.length; j++) {
                  var image = currentPlaylist.sources[j].media.file_url;
                  image = image.split(' ').join('%20');
                  $("#carousel").append('<img src="' + image + '" class="car_image" id="' + currentPlaylist.sources[j].media.name +'"/>');
                }
              }
            }
            var carousel = $("#carousel").waterwheelCarousel({
              flankingItems: 2,
              separation: 130,
              speed: 500,
              autoPlay: prefs.getInt('time_delay')*1000,
              forcedImageHeight: $(window).height()
            });

            $("#carousel").width($(window).width());
            $("#carousel").height($(window).height());

            waitForMsg();

          });
        }



      $(function () {
        currentImage = "null";
        console.log("versionalpha: " + 27);
        getMedia();
      });


      function specifyImage(image) {
        document.getElementById(image).click();
      }


function waitForMsg(){

    $.ajax({
        type: "GET",
        url: "http://www.lumisnet.com/msgsrv.php",
        crossDomain: true,
        async: true,
        cache: false,
        timeout:5000, 
        success: function(data){ 
          if(data != null && data != currentImage) {
            currentImage = data;
            specifyImage($.trim(data));
          }
          setTimeout(
            waitForMsg, 
            5000 
          );
        },
        error: function(XMLHttpRequest, textStatus, errorThrown){
            setTimeout(
                waitForMsg,
                5000
            ); 
        }
    });
};







    </script>


    <style type="text/css">
      body {
        font-family:Arial;
        font-size:12px;
        background:transparent;
      }


      #carousel {
        width:630px;
        height:349px;
        position:relative;
        clear:both;
        overflow:hidden;
        background:transparent;
      }
      #carousel img {
        visibility:hidden; 
        cursor:pointer; 
        width: 200px;
        height: 349px;
        -webkit-box-reflect:below 0px -webkit-gradient(linear, left top, left bottom, from(transparent), color-stop(0.80, transparent), to(rgba(255,255,255,.50)));
      }

      .split-left {
        width:450px;
        float:left;
      }
      .split-right {
        width:400px;
        float:left;
        margin-left:10px;
      }
    </style>
  </head>

  <body>
    <div id="carousel">
        
    </div>
  </body>

</html>

]]>
</Content>
</Module>