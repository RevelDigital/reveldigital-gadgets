<?xml version="1.0" encoding="UTF-8" ?> 
<Module> 
<ModulePrefs title="RevelDigital QR Control Test" description="Control digital signage with QR code." author="RevelDigital" background="transparent">
  <UserPref name="apikey" display_name="API Key" datatype="string" default_value="null" required="true" />
  <UserPref name="image_width" display_name="Image Width" default_value="570" datatype="string" required="true" />
  <UserPref name="image_height" display_name="Image Height" default_value="1035" datatype="string" required="true" />
</ModulePrefs>
<Content type="html">
<![CDATA[

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">

#imageview {

}

</style>


<script type="text/javascript" charset="utf-8">

var prefs = new gadgets.Prefs();


$(function() {

    console.log("Version: " + 3);
    waitForMsg();
});


function showImage(image) {
    image = image.split(' ').join('%20');
    var tempImage = new Image();
    tempImage.src = image;
    tempImage.width = prefs.getInt("image_width")
    tempImage.height = prefs.getInt("image_height")

    $("#imageview").html(tempImage);
}



function waitForMsg(){

    $.ajax({
        type: "GET",
        url: "http://www.lumisnet.com/msgsrv.php",
        crossDomain: true,
        async: true,
        cache: false,
        timeout:50000, 
        success: function(data){ 
            showImage(data)
            setTimeout(
                waitForMsg, 
                1000 
            );
        },
        error: function(XMLHttpRequest, textStatus, errorThrown){
            setTimeout(
                waitForMsg,
                1000
            ); 
        }
    });
};

</script>







<body>
    <div id="imageview">
    </div>
</body>



]]>
</Content>
</Module>